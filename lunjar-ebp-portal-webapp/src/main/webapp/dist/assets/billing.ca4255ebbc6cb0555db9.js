webpackJsonp([1],{0:function(e,i,t){e.exports=t(33)},33:function(e,i,t){"use strict";function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function d(e,i){function t(i){1===e.length?window.location.href="/trade/detail?tradeId="+e[0].id:window.location.href="/trade/list?status=3"}var a=i,s=[],d={realPrice:0};i||(i=e[0].tradeNo,a=e[0].id),e.forEach(function(e){d.realPrice+=e.realPrice,s.push(e.shopName)}),d.shopName=s.join(","),d.tradeNo=i,(0,h.weixinPay)(window.openId,d).then(function(e){c["default"].Loading.hide(),(0,f.showSuccessTip)("支付成功！",3e3),(0,v.paySuccess)(a).then(t,t)},function(e){c["default"].Loading.hide(),window.location.href="/trade/list?status=2"})}var l=function(){function e(e,i){for(var t=0;t<i.length;t++){var a=i[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(i,t,a){return t&&e(i.prototype,t),a&&e(i,a),i}}(),n=t(3);t(64);var o=t(1),c=a(o),r=t(2),u=a(r),p=t(9),v=t(7),h=t(11),f=t(4),m=t(82),b=a(m),y=t(81),g=a(y),j=t(80),k=a(j),w=function(){function e(){s(this,e),this.commitParams,this.popup,this.bills=globalData.bills,this.postFlag=globalData.postFlag,this.value=globalData.value,this.combineId=globalData.combineId,this.init()}return l(e,[{key:"init",value:function(){1===this.postFlag&&(this.addressId=null,this.getAddList()),this.renderBills(),this.initEvent(),console.log(this.bills)}},{key:"getAddList",value:function(){var e=this;(0,p.getAddressList)().then(function(i){e.addList=i.list})}},{key:"renderBills",value:function(){var e=u["default"].compile(b["default"])({bills:this.bills});(0,c["default"])("#billList").html(e)}},{key:"initEvent",value:function(){var e=this;(0,c["default"])(document).on("click",".js-show-add",function(){e.showAddList()}).on("click",".js-choose-add",function(i){e.chooseAdd((0,c["default"])(i.currentTarget))}).on("click",".js-back",function(){e.popup.cancel()}).on("click",".js-show-collect",function(i){e.showCollect((0,c["default"])(i.currentTarget))}).on("click",".js-choose-collect",function(i){e.chooseCollect((0,c["default"])(i.currentTarget))}).on("click",".js-select-date",function(i){e.showSelectColDate((0,c["default"])(i.currentTarget))}).on("click",'.js-commit:not(".disabled")',function(i){e.commit((0,c["default"])(i.currentTarget))}).on("change",".js-invoice",function(i){e.toggleShowInvoiceOption((0,c["default"])(i.currentTarget))}).on("change",".js-invoice-type",function(i){e.chooseInvoiceType((0,c["default"])(i.currentTarget))})}},{key:"chooseInvoiceType",value:function(e){return console.log(e.prop("checked")),!1}},{key:"toggleShowInvoiceOption",value:function(e){var i=e.parents(".js-bill"),t=i.find(".js-invoice-option");e.prop("checked")?t.removeClass("z-hidden"):t.addClass("z-hidden")}},{key:"commit",value:function(e){this.validateForm()&&(e.addClass("disabled"),this.getCommitParams(),c["default"].Loading.show(),(0,v.commitTrade)(JSON.stringify(this.commitParams),this.value,this.combineId).then(function(e){var i=e.data;d(i.payNo?i.trades:i,i.payNo)},function(i){e.removeClass("disabled"),c["default"].Loading.hide(),alert(JSON.stringify(i))}))}},{key:"getCommitParams",value:function(){var e=this;this.commitParams=this.bills.map(function(i,t){var a=(0,c["default"])('.js-bill[data-index="'+t+'"]'),s={};return e.value||(s.cartIdList=i.listCartDto.map(function(e){return e.id})),s.enterpriseId=i.enterpriseId,s.addressId=2===i.distributionMode?i.addressId:e.addressId,s.isInvoice=a.find(".js-invoice").prop("checked")?1:0,1===s.isInvoice&&(s.invoiceType=a.find(".js-invoice-type:checked").val(),s.invoiceName=a.find(".js-invoice-name").val()),2===i.distributionMode&&(s.buyerName=a.find(".js-collect-name").val(),s.buyerPhone=a.find(".js-collect-mobile").val(),s.collectTime=a.find('input[name="collectTime"]').val()),s.buyerRemarks=a.find('textarea[name="buyerRemarks"]').val(),s})}},{key:"validateForm",value:function(){return 1!==this.postFlag||this.addressId?this.validateInvoice()&&this.validateCollect():(n.Message.show({content:"请选择快递收货地址"}),!1)}},{key:"validateInvoice",value:function(){for(var e=!0,i=(0,c["default"])(".js-bill"),t=0,a=i.length;t<a;t++){var s=(0,c["default"])(i[t]);if(s.find(".js-invoice").prop("checked")&&!s.find(".js-invoice-name").val()){e=!1,n.Message.show({content:"请输入发票抬头"});break}}return e}},{key:"validateCollect",value:function(){for(var e=!0,i=/^1[3578][0-9]{9}$/,t=0,a=this.bills.length;t<a;t++){var s=this.bills[t],d=(0,c["default"])('.js-bill[data-index="'+t+'"]');if(1!==s.distributionMode){if(2===s.distributionMode&&!s.addressId){e=!1,n.Message.show({content:"请选择自提地址"});break}if(!c["default"].trim(d.find(".js-collect-name").val())){e=!1,n.Message.show({content:"请输入自提人姓名"});break}if(!i.test(d.find(".js-collect-mobile").val())){e=!1,n.Message.show({content:"请输入正确的自提人手机"});break}}}return e}},{key:"chooseCollect",value:function(e){var i,t=+e.data("id"),a=+e.data("bill");this.bills[a].collectPlaces.forEach(function(e){e.id===t&&(i=e)}),this.renderCollectAdd(i,a),this.popup.confirm(),this.bills[a].addressId=t,this.changeCollectPrice(a,i);var s=(0,c["default"])('.js-select-date[data-index="'+a+'"]'),d=new Date(i.collectStartTime),l=s.find("input"),n=c["default"].Datepicker.date2str(c["default"].Datepicker.parseDate(d));l.data("min",i.collectStartTime),l.data("max",i.collectEndTime),l.val(n),s.find("span").text("提货日期："+n),s.removeClass("z-hidden"),this.showSelectColDate(s,i.collectStartTime,i.collectEndTime)}},{key:"showSelectColDate",value:function(e,i,t){var a=e.find("input"),s=a.val();i||(i=a.data("min"),t=a.data("max"));var d=new Date(i),l=new Date(t);c["default"].Datepicker({date:new Date(s.replace(/-/g,"/")),minDate:d,maxDate:l,confirm:function(i){a.val(i),e.find("span").text("提货日期："+i)}})}},{key:"changeCollectPrice",value:function(e,i){var t=(0,c["default"])('.js-bill[data-index="'+e+'"]'),a=t.find(".js-bill-price"),s=+a.html()+i.fee;a.html(s),t.find(".js-price-info").html("（自提费￥"+i.fee+"）"),this.changeTotalPrice()}},{key:"changeTotalPrice",value:function(){var e=0;(0,c["default"])(".js-bill-price").each(function(i,t){e+=+(0,c["default"])(t).html()}),(0,c["default"])(".js-total").html(e)}},{key:"renderCollectAdd",value:function(e,i){var t=u["default"].compile(k["default"])({add:e,type:2});(0,c["default"])('.js-bill[data-index="'+i+'"]').find(".js-show-collect").html(t)}},{key:"showCollect",value:function(e){var i=+e.data("index");this.popup||(this.popup=(new n.Popup).render()),this.popup.renderContent(u["default"].compile(g["default"])({addList:this.bills[i].collectPlaces,type:2,billIndex:i})).show()}},{key:"chooseAdd",value:function(e){var i,t=+e.data("id");return t===this.addressId?void this.popup.cancel():(this.addList.forEach(function(e){e.id===t&&(i=e)}),this.renderAdd(i),this.popup.confirm(),this.addressId=t,void this.changeExpressPrice())}},{key:"changeExpressPrice",value:function(){var e=this;if(this.value)(0,v.asynCombineExpress)(this.combineId,this.bills[0].enterpriseId,this.addressId).then(function(i){e.renderExpressPrice(i)});else{var i=[];this.bills.forEach(function(e){1===e.distributionMode&&(i=i.concat(e.listCartDto.map(function(e){return e.id})))}),(0,v.asynExpress)(i.join(","),this.addressId).then(function(i){e.renderExpressPrice(i)})}}},{key:"renderExpressPrice",value:function(e){var i=this,t=e.data.cartDtos;t.forEach(function(e){var t=(0,c["default"])('.js-bill[data-id="'+e.enterpriseId+'"]'),a=t.find(".js-bill-price"),s=+a.html()+e.discountDto.expressPrice;a.html(s),t.find(".js-price-info").html("（快递费￥"+e.discountDto.expressPrice+"）"),i.changeTotalPrice()})}},{key:"renderAdd",value:function(e){var i=u["default"].compile(k["default"])({add:e,type:1});(0,c["default"])(".js-add-detail").html(i)}},{key:"showAddList",value:function(){this.popup||(this.popup=(new n.Popup).render()),this.popup.renderContent(u["default"].compile(g["default"])({addList:this.addList,type:1})).show()}}]),e}();new w},64:function(e,i){},80:function(e,i){e.exports="<div class=detail> {{if type === 1}} <div>收货人：{{add.buyerName}}</div> <div>电话：{{add.buyerPhone}}</div> <div>收货地址：{{add.province}}{{add.city}}{{add.region}}{{add.buyerAddress}}</div> {{else if type === 2}} <div>自提点：{{add.clpName}}</div> <div>自提点电话：{{add.clpTelephone}}</div> <div>自提点地址：{{add.clpAddress}}</div> <div>营业时间：{{add.startTime}}～{{add.endTime}}</div> {{/if}} </div>"},81:function(e,i){e.exports='<div class=address-wrap id=main style=background-color:#f7f7f7> <div class=address-content> {{if type === 1}} {{each addList as add}} <div class="address js-choose-add" data-id={{add.id}}> <a href=javascript:void(0); class="address-info choose"> <div class=ad-info> <div>{{add.buyerName}}</div> <div>{{add.buyerPhone}}</div> </div> <div class=ad-detail>{{add.province}}{{add.city}}{{add.region}}{{add.buyerAddress}}</div> </a> </div> {{/each}} {{else if type === 2}} {{each addList as add}} <div class="address js-choose-collect" data-id={{add.id}} data-bill={{billIndex}}> <a href=javascript:void(0); class="address-info choose"> <div class=ad-info> <div>{{add.clpName}}</div> <div>{{add.clpTelephone}}</div> </div> <div class=ad-detail>{{add.clpAddress}}</div> </a> </div> {{/each}} {{/if}} </div> </div> <div class=buttons> {{if type === 1}} <a href=/buyAddress/list class=new-btn>添加新地址</a> {{/if}} <a href=javascript:void(0); class="back-btn js-back">返回</a> </div>'},82:function(e,i){e.exports='{{each bills as bill index}} <div class="bill js-bill" data-index={{index}} data-id={{bill.enterpriseId}}> <div class="shop-header bill-item"> <img src={{bill.headPicUrl}} alt="" class=shop-pic> <span>{{bill.enterpriseName}}</span> </div> <div class=items> {{each bill.listCartDto as item}} <div class=item> <a href=javascript:void(0);> <img src={{item.picPath}} alt="" class=product> </a> <div class=pro-right> <div class=pro-name>{{item.productName}}</div> <div class=pro-sku>{{item.propertiesname}}</div> <div class=detail> <span class=price>￥ {{item.productRealPrice}}</span> <span class=num>X {{item.num}}</span> </div> </div> </div> {{/each}} </div> {{if bill.discountDto.discountDesc}} <div class="deliver bill-item"> <span>优惠信息：</span> <span>{{bill.discountDto.discountDesc}}</span> </div> {{/if}} {{if bill.distributionMode === 2}} <div class="bill-item bill-link js-show-collect" data-index={{index}}> <span>请选择自提地址</span> </div> <div class="bill-item bill-link z-hidden js-select-date" data-index={{index}}> <input type=hidden name=collectTime> <span>请选择提货时间</span> </div> <div class=bill-item> 自提人姓名：<input type=text class="bill-input js-collect-name" placeholder=自提人姓名> </div> <div class=bill-item> 自提人手机：<input type=number class="bill-input js-collect-mobile" placeholder=自提人手机> </div> {{/if}} <div class=bill-item> <label class=radios_box> <input type=checkbox class="input_redu js-invoice"> </label> <span>是否需要发票</span> </div> <div class="bill-item js-invoice-option z-hidden"> <label class="radios_box checked"> <input type=radio name=invoiceType class="input_redu js-invoice-type" checked=checked value=1> </label> <span>电子发票</span> <label class=radios_box> <input type=radio name=invoiceType class="input_redu js-invoice-type" value=2> </label> <span>纸质发票</span> </div> <div class="bill-item js-invoice-option z-hidden"> <input type=text class="bill-input bill-input-invoice js-invoice-name" placeholder=发票抬头> </div> <div class="memo bill-item"> <textarea class=bill-input name=buyerRemarks placeholder=给卖家留言></textarea> </div> <div class="total bill-item"> <span>共 <strong>{{bill.num}}</strong> 件商品</span> <span>合计：<strong>￥ <span class=js-bill-price>{{bill.discountDto.realPrice}}</span><span class=js-price-info></span></strong></span> </div> </div> {{/each}}'}});
//# sourceMappingURL=billing.ca4255ebbc6cb0555db9.js.map