{"version":3,"sources":["webpack:///billing.ca4255ebbc6cb0555db9.js","webpack:///./assets/pages/billing/index.js","webpack:///./assets/pages/billing/address-detail.tpl","webpack:///./assets/pages/billing/address-list.tpl","webpack:///./assets/pages/billing/bill.tpl"],"names":["webpackJsonp","0","module","exports","__webpack_require__","33","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","payForTrade","trades","payNo","success","res","length","window","location","href","id","tid","shopNames","trade","realPrice","tradeNo","forEach","item","push","shopName","join","_weixinApi","weixinPay","openId","then","_jquery2","Loading","hide","_responseUtil","showSuccessTip","_tradeApi","paySuccess","e","_createClass","defineProperties","target","props","i","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","_component","_jquery","_template","_template2","_addressApi","_bill","_bill2","_addressList","_addressList2","_addressDetail","_addressDetail2","Billing","this","commitParams","popup","bills","globalData","postFlag","value","combineId","init","addressId","getAddList","renderBills","initEvent","console","log","_this","getAddressList","addList","list","tpl","compile","html","_this2","document","on","showAddList","chooseAdd","currentTarget","cancel","showCollect","chooseCollect","showSelectColDate","commit","toggleShowInvoiceOption","chooseInvoiceType","$checkbox","prop","$bill","parents","$invoiceOption","find","removeClass","addClass","$btn","validateForm","getCommitParams","show","commitTrade","JSON","stringify","data","err","alert","_this3","map","bill","index","result","cartIdList","listCartDto","cart","enterpriseId","distributionMode","isInvoice","invoiceType","val","invoiceName","buyerName","buyerPhone","collectTime","buyerRemarks","validateInvoice","validateCollect","Message","content","canSubmit","$bills","len","regMobile","trim","test","$add","add","billIndex","collectPlaces","renderCollectAdd","confirm","changeCollectPrice","$date","colStartDate","Date","collectStartTime","$dateIpt","dateStr","Datepicker","date2str","parseDate","collectEndTime","text","$input","colEndDate","date","replace","minDate","maxDate","$billPrice","newPrice","fee","changeTotalPrice","total","each","price","type","Popup","render","renderContent","renderAdd","changeExpressPrice","_this4","asynCombineExpress","renderExpressPrice","ids","concat","asynExpress","_this5","newBills","cartDtos","discountDto","expressPrice","64","80","81","82"],"mappings":"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","file":"billing.ca4255ebbc6cb0555db9.js","sourcesContent":["webpackJsonp([1],{\n\n/***/ 0:\n/***/ function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(33);\n\n\n/***/ },\n\n/***/ 33:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); // import '../../components/base';\n\t// import '../../components/address-list';\n\t\n\t\n\tvar _component = __webpack_require__(3);\n\t\n\t__webpack_require__(64);\n\t\n\tvar _jquery = __webpack_require__(1);\n\t\n\tvar _jquery2 = _interopRequireDefault(_jquery);\n\t\n\tvar _template = __webpack_require__(2);\n\t\n\tvar _template2 = _interopRequireDefault(_template);\n\t\n\tvar _addressApi = __webpack_require__(9);\n\t\n\tvar _tradeApi = __webpack_require__(7);\n\t\n\tvar _weixinApi = __webpack_require__(11);\n\t\n\tvar _responseUtil = __webpack_require__(4);\n\t\n\tvar _bill = __webpack_require__(82);\n\t\n\tvar _bill2 = _interopRequireDefault(_bill);\n\t\n\tvar _addressList = __webpack_require__(81);\n\t\n\tvar _addressList2 = _interopRequireDefault(_addressList);\n\t\n\tvar _addressDetail = __webpack_require__(80);\n\t\n\tvar _addressDetail2 = _interopRequireDefault(_addressDetail);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction payForTrade(trades, payNo) {\n\t  var tid = payNo;\n\t  var shopNames = [];\n\t  var trade = {\n\t    realPrice: 0\n\t  };\n\t\n\t  // 单个订单支付\n\t  if (!payNo) {\n\t    payNo = trades[0].tradeNo;\n\t    tid = trades[0].id;\n\t  }\n\t\n\t  trades.forEach(function (item) {\n\t    trade.realPrice += item.realPrice;\n\t    shopNames.push(item.shopName);\n\t  });\n\t\n\t  trade.shopName = shopNames.join(',');\n\t  trade.tradeNo = payNo;\n\t  // alert(JSON.stringify(trade));\n\t  (0, _weixinApi.weixinPay)(window.openId, trade).then(function (res) {\n\t    // alert(JSON.stringify(res));\n\t    _jquery2.default.Loading.hide();\n\t    (0, _responseUtil.showSuccessTip)('支付成功！', 3000);\n\t    (0, _tradeApi.paySuccess)(tid).then(success, success);\n\t  }, function (e) {\n\t    // alert('error----' + JSON.stringify(e));\n\t    _jquery2.default.Loading.hide();\n\t    window.location.href = '/trade/list?status=2';\n\t  });\n\t\n\t  function success(res) {\n\t    if (trades.length === 1) {\n\t      window.location.href = '/trade/detail?tradeId=' + trades[0].id;\n\t    } else {\n\t      window.location.href = '/trade/list?status=3';\n\t    }\n\t  }\n\t}\n\t\n\tvar Billing = function () {\n\t  function Billing() {\n\t    _classCallCheck(this, Billing);\n\t\n\t    this.commitParams;\n\t    this.popup;\n\t    this.bills = globalData.bills;\n\t    this.postFlag = globalData.postFlag;\n\t    this.value = globalData.value;\n\t    this.combineId = globalData.combineId;\n\t    this.init();\n\t  }\n\t\n\t  _createClass(Billing, [{\n\t    key: 'init',\n\t    value: function init() {\n\t      if (this.postFlag === 1) {\n\t        this.addressId = null;\n\t        this.getAddList();\n\t      }\n\t      this.renderBills();\n\t\n\t      this.initEvent();\n\t\n\t      console.log(this.bills);\n\t    }\n\t    /**\n\t     * 获取买家的地址列表\n\t     */\n\t\n\t  }, {\n\t    key: 'getAddList',\n\t    value: function getAddList() {\n\t      var _this = this;\n\t\n\t      (0, _addressApi.getAddressList)().then(function (res) {\n\t        _this.addList = res.list;\n\t      });\n\t    }\n\t    /**\n\t     * 渲染订单\n\t     */\n\t\n\t  }, {\n\t    key: 'renderBills',\n\t    value: function renderBills() {\n\t      var tpl = _template2.default.compile(_bill2.default)({\n\t        bills: this.bills\n\t      });\n\t      (0, _jquery2.default)('#billList').html(tpl);\n\t    }\n\t  }, {\n\t    key: 'initEvent',\n\t    value: function initEvent() {\n\t      var _this2 = this;\n\t\n\t      (0, _jquery2.default)(document).on('click', '.js-show-add', function () {\n\t        _this2.showAddList();\n\t      }).on('click', '.js-choose-add', function (e) {\n\t        _this2.chooseAdd((0, _jquery2.default)(e.currentTarget));\n\t      }).on('click', '.js-back', function () {\n\t        _this2.popup.cancel();\n\t      }).on('click', '.js-show-collect', function (e) {\n\t        _this2.showCollect((0, _jquery2.default)(e.currentTarget));\n\t      }).on('click', '.js-choose-collect', function (e) {\n\t        _this2.chooseCollect((0, _jquery2.default)(e.currentTarget));\n\t      }).on('click', '.js-select-date', function (e) {\n\t        _this2.showSelectColDate((0, _jquery2.default)(e.currentTarget));\n\t      }).on('click', '.js-commit:not(\".disabled\")', function (e) {\n\t        _this2.commit((0, _jquery2.default)(e.currentTarget));\n\t      }).on('change', '.js-invoice', function (e) {\n\t        _this2.toggleShowInvoiceOption((0, _jquery2.default)(e.currentTarget));\n\t      }).on('change', '.js-invoice-type', function (e) {\n\t        _this2.chooseInvoiceType((0, _jquery2.default)(e.currentTarget));\n\t      });\n\t    }\n\t  }, {\n\t    key: 'chooseInvoiceType',\n\t    value: function chooseInvoiceType($checkbox) {\n\t      console.log($checkbox.prop('checked'));\n\t      return false;\n\t    }\n\t    /**\n\t     * 展示发票信息表单\n\t     * @param  {Object} $checkbox checkbox对象\n\t     */\n\t\n\t  }, {\n\t    key: 'toggleShowInvoiceOption',\n\t    value: function toggleShowInvoiceOption($checkbox) {\n\t      var $bill = $checkbox.parents('.js-bill');\n\t      // var billIndex = +$bill.data('index');\n\t      var $invoiceOption = $bill.find('.js-invoice-option');\n\t      if ($checkbox.prop('checked')) {\n\t        $invoiceOption.removeClass('z-hidden');\n\t      } else {\n\t        $invoiceOption.addClass('z-hidden');\n\t      }\n\t      // this.bills[billIndex].isInvoice = $checkbox.prop('checked') ? 1 : 0;\n\t    }\n\t    /**\n\t     * 提交订单\n\t     * @param  {Object} $btn 按钮\n\t     */\n\t\n\t  }, {\n\t    key: 'commit',\n\t    value: function commit($btn) {\n\t      if (!this.validateForm()) {\n\t        return;\n\t      }\n\t      $btn.addClass('disabled');\n\t      this.getCommitParams();\n\t\n\t      _jquery2.default.Loading.show();\n\t      (0, _tradeApi.commitTrade)(JSON.stringify(this.commitParams), this.value, this.combineId).then(function (res) {\n\t        var data = res.data;\n\t\n\t        // alert(JSON.stringify(res));\n\t        payForTrade(data.payNo ? data.trades : data, data.payNo);\n\t      }, function (err) {\n\t        $btn.removeClass('disabled');\n\t        _jquery2.default.Loading.hide();\n\t        alert(JSON.stringify(err));\n\t      });\n\t    }\n\t    /**\n\t     * 获取将要提交的订单信息\n\t     */\n\t\n\t  }, {\n\t    key: 'getCommitParams',\n\t    value: function getCommitParams() {\n\t      var _this3 = this;\n\t\n\t      this.commitParams = this.bills.map(function (bill, index) {\n\t        var $bill = (0, _jquery2.default)('.js-bill[data-index=\"' + index + '\"]');\n\t        var result = {};\n\t        if (!_this3.value) {\n\t          result.cartIdList = bill.listCartDto.map(function (cart) {\n\t            return cart.id;\n\t          });\n\t        }\n\t        result.enterpriseId = bill.enterpriseId;\n\t        // 地址\n\t        result.addressId = bill.distributionMode === 2 ? bill.addressId : _this3.addressId;\n\t        // 发票内容\n\t        result.isInvoice = $bill.find('.js-invoice').prop('checked') ? 1 : 0;\n\t        if (result.isInvoice === 1) {\n\t          result.invoiceType = $bill.find('.js-invoice-type:checked').val();\n\t          result.invoiceName = $bill.find('.js-invoice-name').val();\n\t        }\n\t        // 自提内容\n\t        if (bill.distributionMode === 2) {\n\t          result.buyerName = $bill.find('.js-collect-name').val();\n\t          result.buyerPhone = $bill.find('.js-collect-mobile').val();\n\t          result.collectTime = $bill.find('input[name=\"collectTime\"]').val();\n\t        }\n\t        result.buyerRemarks = $bill.find('textarea[name=\"buyerRemarks\"]').val();\n\t        return result;\n\t      });\n\t    }\n\t    /**\n\t     * 校验表单\n\t     * @return {Boolean} 是否通过验证\n\t     */\n\t\n\t  }, {\n\t    key: 'validateForm',\n\t    value: function validateForm() {\n\t      if (this.postFlag === 1 && !this.addressId) {\n\t        _component.Message.show({\n\t          content: '请选择快递收货地址'\n\t        });\n\t        return false;\n\t      }\n\t\n\t      return this.validateInvoice() && this.validateCollect();\n\t    }\n\t    /**\n\t     * 校验发票信息\n\t     * @return {Boolean} 是否通过验证\n\t     */\n\t\n\t  }, {\n\t    key: 'validateInvoice',\n\t    value: function validateInvoice() {\n\t      var canSubmit = true;\n\t      var $bills = (0, _jquery2.default)('.js-bill');\n\t\n\t      for (var i = 0, len = $bills.length; i < len; i++) {\n\t        var $bill = (0, _jquery2.default)($bills[i]);\n\t        if (!$bill.find('.js-invoice').prop('checked')) {\n\t          continue;\n\t        } else if (!$bill.find('.js-invoice-name').val()) {\n\t          canSubmit = false;\n\t          _component.Message.show({\n\t            content: '请输入发票抬头'\n\t          });\n\t          break;\n\t        }\n\t      }\n\t      return canSubmit;\n\t    }\n\t    /**\n\t     * 校验自提信息\n\t     * @return {Boolean} 是否通过验证\n\t     */\n\t\n\t  }, {\n\t    key: 'validateCollect',\n\t    value: function validateCollect() {\n\t      var canSubmit = true;\n\t      var regMobile = /^1[3578][0-9]{9}$/;\n\t      for (var i = 0, len = this.bills.length; i < len; i++) {\n\t        var bill = this.bills[i];\n\t        var $bill = (0, _jquery2.default)('.js-bill[data-index=\"' + i + '\"]');\n\t        if (bill.distributionMode === 1) {\n\t          continue;\n\t        }\n\t        if (bill.distributionMode === 2 && !bill.addressId) {\n\t          canSubmit = false;\n\t          _component.Message.show({\n\t            content: '请选择自提地址'\n\t          });\n\t          break;\n\t        }\n\t        if (!_jquery2.default.trim($bill.find('.js-collect-name').val())) {\n\t          canSubmit = false;\n\t          _component.Message.show({\n\t            content: '请输入自提人姓名'\n\t          });\n\t          break;\n\t        }\n\t        if (!regMobile.test($bill.find('.js-collect-mobile').val())) {\n\t          canSubmit = false;\n\t          _component.Message.show({\n\t            content: '请输入正确的自提人手机'\n\t          });\n\t          break;\n\t        }\n\t      }\n\t      return canSubmit;\n\t    }\n\t    /**\n\t     * 选择自提地址\n\t     * @param  {Object} $add 被选的自提地址DOM\n\t     */\n\t\n\t  }, {\n\t    key: 'chooseCollect',\n\t    value: function chooseCollect($add) {\n\t      var add;\n\t      var id = +$add.data('id');\n\t      var billIndex = +$add.data('bill');\n\t      this.bills[billIndex].collectPlaces.forEach(function (item) {\n\t        if (item.id === id) {\n\t          add = item;\n\t        }\n\t      });\n\t      this.renderCollectAdd(add, billIndex);\n\t      this.popup.confirm();\n\t      this.bills[billIndex].addressId = id;\n\t      this.changeCollectPrice(billIndex, add);\n\t\n\t      var $date = (0, _jquery2.default)('.js-select-date[data-index=\"' + billIndex + '\"]');\n\t      var colStartDate = new Date(add.collectStartTime);\n\t      var $dateIpt = $date.find('input');\n\t      var dateStr = _jquery2.default.Datepicker.date2str(_jquery2.default.Datepicker.parseDate(colStartDate));\n\t\n\t      $dateIpt.data('min', add.collectStartTime);\n\t      $dateIpt.data('max', add.collectEndTime);\n\t      $dateIpt.val(dateStr);\n\t      $date.find('span').text('提货日期：' + dateStr);\n\t      $date.removeClass('z-hidden');\n\t      this.showSelectColDate($date, add.collectStartTime, add.collectEndTime);\n\t    }\n\t  }, {\n\t    key: 'showSelectColDate',\n\t    value: function showSelectColDate($date, collectStartTime, collectEndTime) {\n\t      var $input = $date.find('input');\n\t      var val = $input.val();\n\t\n\t      if (!collectStartTime) {\n\t        collectStartTime = $input.data('min');\n\t        collectEndTime = $input.data('max');\n\t      }\n\t      var colStartDate = new Date(collectStartTime);\n\t      var colEndDate = new Date(collectEndTime);\n\t\n\t      _jquery2.default.Datepicker({\n\t        date: new Date(val.replace(/-/g, '/')),\n\t        minDate: colStartDate,\n\t        maxDate: colEndDate,\n\t        confirm: function confirm(dateStr) {\n\t          $input.val(dateStr);\n\t          $date.find('span').text('提货日期：' + dateStr);\n\t        }\n\t      });\n\t    }\n\t\n\t    /**\n\t     * 更新自提订单的价格\n\t     * @param  {Number} index 订单索引\n\t     * @param  {Object} add   地址对象\n\t     */\n\t\n\t  }, {\n\t    key: 'changeCollectPrice',\n\t    value: function changeCollectPrice(index, add) {\n\t      var $bill = (0, _jquery2.default)('.js-bill[data-index=\"' + index + '\"]');\n\t      var $billPrice = $bill.find('.js-bill-price');\n\t      var newPrice = +$billPrice.html() + add.fee;\n\t      $billPrice.html(newPrice);\n\t      $bill.find('.js-price-info').html('（自提费￥' + add.fee + '）');\n\t      this.changeTotalPrice();\n\t    }\n\t    /**\n\t     * 更新总价\n\t     */\n\t\n\t  }, {\n\t    key: 'changeTotalPrice',\n\t    value: function changeTotalPrice() {\n\t      var total = 0;\n\t      (0, _jquery2.default)('.js-bill-price').each(function (index, price) {\n\t        total += +(0, _jquery2.default)(price).html();\n\t      });\n\t      (0, _jquery2.default)('.js-total').html(total);\n\t    }\n\t    /**\n\t     * 渲染选中的自提地址\n\t     * @param  {Object} add       地址对象\n\t     * @param  {Number} billIndex 订单索引\n\t     */\n\t\n\t  }, {\n\t    key: 'renderCollectAdd',\n\t    value: function renderCollectAdd(add, billIndex) {\n\t      var tpl = _template2.default.compile(_addressDetail2.default)({\n\t        add: add,\n\t        type: 2\n\t      });\n\t      (0, _jquery2.default)('.js-bill[data-index=\"' + billIndex + '\"]').find('.js-show-collect').html(tpl);\n\t    }\n\t    /**\n\t     * 展示自提地址列表\n\t     * @param  {Object} $btn 按钮对象\n\t     */\n\t\n\t  }, {\n\t    key: 'showCollect',\n\t    value: function showCollect($btn) {\n\t      var index = +$btn.data('index');\n\t      if (!this.popup) {\n\t        this.popup = new _component.Popup().render();\n\t      }\n\t      this.popup.renderContent(_template2.default.compile(_addressList2.default)({\n\t        addList: this.bills[index].collectPlaces,\n\t        type: 2,\n\t        billIndex: index\n\t      })).show();\n\t    }\n\t    /**\n\t     * 选择地址\n\t     * @param  {Object} $add 被选中的地址对象\n\t     */\n\t\n\t  }, {\n\t    key: 'chooseAdd',\n\t    value: function chooseAdd($add) {\n\t      var id = +$add.data('id');\n\t      var add;\n\t      if (id === this.addressId) {\n\t        this.popup.cancel();\n\t        return;\n\t      }\n\t      this.addList.forEach(function (item) {\n\t        if (item.id === id) {\n\t          add = item;\n\t        }\n\t      });\n\t      this.renderAdd(add);\n\t      this.popup.confirm();\n\t      this.addressId = id;\n\t      this.changeExpressPrice();\n\t    }\n\t    /**\n\t     * 更新快递订单的价格\n\t     */\n\t\n\t  }, {\n\t    key: 'changeExpressPrice',\n\t    value: function changeExpressPrice() {\n\t      var _this4 = this;\n\t\n\t      var fn;\n\t      if (!this.value) {\n\t        var ids = [];\n\t        this.bills.forEach(function (bill) {\n\t          if (bill.distributionMode === 1) {\n\t            ids = ids.concat(bill.listCartDto.map(function (cart) {\n\t              return cart.id;\n\t            }));\n\t          }\n\t        });\n\t        (0, _tradeApi.asynExpress)(ids.join(','), this.addressId).then(function (res) {\n\t          _this4.renderExpressPrice(res);\n\t        });\n\t      } else {\n\t        (0, _tradeApi.asynCombineExpress)(this.combineId, this.bills[0].enterpriseId, this.addressId).then(function (res) {\n\t          _this4.renderExpressPrice(res);\n\t        });\n\t      }\n\t    }\n\t  }, {\n\t    key: 'renderExpressPrice',\n\t    value: function renderExpressPrice(res) {\n\t      var _this5 = this;\n\t\n\t      var newBills = res.data.cartDtos;\n\t      newBills.forEach(function (bill) {\n\t        var $bill = (0, _jquery2.default)('.js-bill[data-id=\"' + bill.enterpriseId + '\"]');\n\t        var $billPrice = $bill.find('.js-bill-price');\n\t        var newPrice = +$billPrice.html() + bill.discountDto.expressPrice;\n\t        $billPrice.html(newPrice);\n\t        $bill.find('.js-price-info').html('（快递费￥' + bill.discountDto.expressPrice + '）');\n\t        _this5.changeTotalPrice();\n\t      });\n\t    }\n\t\n\t    /**\n\t     * 渲染被选中的快递地址\n\t     * @param  {Object} add 地址对象\n\t     */\n\t\n\t  }, {\n\t    key: 'renderAdd',\n\t    value: function renderAdd(add) {\n\t      var tpl = _template2.default.compile(_addressDetail2.default)({\n\t        add: add,\n\t        type: 1\n\t      });\n\t      (0, _jquery2.default)('.js-add-detail').html(tpl);\n\t    }\n\t    /**\n\t     * 展示快递地址列表\n\t     */\n\t\n\t  }, {\n\t    key: 'showAddList',\n\t    value: function showAddList() {\n\t      if (!this.popup) {\n\t        this.popup = new _component.Popup().render();\n\t      }\n\t      this.popup.renderContent(_template2.default.compile(_addressList2.default)({\n\t        addList: this.addList,\n\t        type: 1\n\t      })).show();\n\t    }\n\t  }]);\n\t\n\t  return Billing;\n\t}();\n\t\n\tnew Billing();\n\n/***/ },\n\n/***/ 64:\n/***/ function(module, exports) {\n\n\t// removed by extract-text-webpack-plugin\n\n/***/ },\n\n/***/ 80:\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<div class=detail> {{if type === 1}} <div>收货人：{{add.buyerName}}</div> <div>电话：{{add.buyerPhone}}</div> <div>收货地址：{{add.province}}{{add.city}}{{add.region}}{{add.buyerAddress}}</div> {{else if type === 2}} <div>自提点：{{add.clpName}}</div> <div>自提点电话：{{add.clpTelephone}}</div> <div>自提点地址：{{add.clpAddress}}</div> <div>营业时间：{{add.startTime}}～{{add.endTime}}</div> {{/if}} </div>\";\n\n/***/ },\n\n/***/ 81:\n/***/ function(module, exports) {\n\n\tmodule.exports = \"<div class=address-wrap id=main style=background-color:#f7f7f7> <div class=address-content> {{if type === 1}} {{each addList as add}} <div class=\\\"address js-choose-add\\\" data-id={{add.id}}> <a href=javascript:void(0); class=\\\"address-info choose\\\"> <div class=ad-info> <div>{{add.buyerName}}</div> <div>{{add.buyerPhone}}</div> </div> <div class=ad-detail>{{add.province}}{{add.city}}{{add.region}}{{add.buyerAddress}}</div> </a> </div> {{/each}} {{else if type === 2}} {{each addList as add}} <div class=\\\"address js-choose-collect\\\" data-id={{add.id}} data-bill={{billIndex}}> <a href=javascript:void(0); class=\\\"address-info choose\\\"> <div class=ad-info> <div>{{add.clpName}}</div> <div>{{add.clpTelephone}}</div> </div> <div class=ad-detail>{{add.clpAddress}}</div> </a> </div> {{/each}} {{/if}} </div> </div> <div class=buttons> {{if type === 1}} <a href=/buyAddress/list class=new-btn>添加新地址</a> {{/if}} <a href=javascript:void(0); class=\\\"back-btn js-back\\\">返回</a> </div>\";\n\n/***/ },\n\n/***/ 82:\n/***/ function(module, exports) {\n\n\tmodule.exports = \"{{each bills as bill index}} <div class=\\\"bill js-bill\\\" data-index={{index}} data-id={{bill.enterpriseId}}> <div class=\\\"shop-header bill-item\\\"> <img src={{bill.headPicUrl}} alt=\\\"\\\" class=shop-pic> <span>{{bill.enterpriseName}}</span> </div> <div class=items> {{each bill.listCartDto as item}} <div class=item> <a href=javascript:void(0);> <img src={{item.picPath}} alt=\\\"\\\" class=product> </a> <div class=pro-right> <div class=pro-name>{{item.productName}}</div> <div class=pro-sku>{{item.propertiesname}}</div> <div class=detail> <span class=price>￥ {{item.productRealPrice}}</span> <span class=num>X {{item.num}}</span> </div> </div> </div> {{/each}} </div> {{if bill.discountDto.discountDesc}} <div class=\\\"deliver bill-item\\\"> <span>优惠信息：</span> <span>{{bill.discountDto.discountDesc}}</span> </div> {{/if}} {{if bill.distributionMode === 2}} <div class=\\\"bill-item bill-link js-show-collect\\\" data-index={{index}}> <span>请选择自提地址</span> </div> <div class=\\\"bill-item bill-link z-hidden js-select-date\\\" data-index={{index}}> <input type=hidden name=collectTime> <span>请选择提货时间</span> </div> <div class=bill-item> 自提人姓名：<input type=text class=\\\"bill-input js-collect-name\\\" placeholder=自提人姓名> </div> <div class=bill-item> 自提人手机：<input type=number class=\\\"bill-input js-collect-mobile\\\" placeholder=自提人手机> </div> {{/if}} <div class=bill-item> <label class=radios_box> <input type=checkbox class=\\\"input_redu js-invoice\\\"> </label> <span>是否需要发票</span> </div> <div class=\\\"bill-item js-invoice-option z-hidden\\\"> <label class=\\\"radios_box checked\\\"> <input type=radio name=invoiceType class=\\\"input_redu js-invoice-type\\\" checked=checked value=1> </label> <span>电子发票</span> <label class=radios_box> <input type=radio name=invoiceType class=\\\"input_redu js-invoice-type\\\" value=2> </label> <span>纸质发票</span> </div> <div class=\\\"bill-item js-invoice-option z-hidden\\\"> <input type=text class=\\\"bill-input bill-input-invoice js-invoice-name\\\" placeholder=发票抬头> </div> <div class=\\\"memo bill-item\\\"> <textarea class=bill-input name=buyerRemarks placeholder=给卖家留言></textarea> </div> <div class=\\\"total bill-item\\\"> <span>共 <strong>{{bill.num}}</strong> 件商品</span> <span>合计：<strong>￥ <span class=js-bill-price>{{bill.discountDto.realPrice}}</span><span class=js-price-info></span></strong></span> </div> </div> {{/each}}\";\n\n/***/ }\n\n});\n\n\n/** WEBPACK FOOTER **\n ** billing.ca4255ebbc6cb0555db9.js\n **/","// import '../../components/base';\n// import '../../components/address-list';\nimport {\n  Popup,\n  Message\n} from 'component'\nimport './billing.scss';\n\nimport $ from 'jquery';\nimport template from 'art-template/dist/template';\nimport { getAddressList } from '../../api/address-api.js';\nimport {\n  commitTrade,\n  asynExpress,\n  asynCombineExpress,\n  paySuccess\n} from '../../api/trade-api.js';\nimport {\n  weixinPay\n} from '../../api/weixin-api.js';\nimport {\n  handleError,\n  showSuccessTip\n} from '../../utils/response-util.js';\n\nimport tplBills from './bill.tpl';\nimport tplAddList from './address-list.tpl';\nimport tplAddDetail from './address-detail.tpl';\n\nfunction payForTrade(trades, payNo) {\n  let tid = payNo;\n  let shopNames = [];\n  let trade = {\n    realPrice: 0\n  };\n\n  // 单个订单支付\n  if (!payNo) {\n    payNo = trades[0].tradeNo;\n    tid = trades[0].id;\n  }\n\n  trades.forEach(item => {\n    trade.realPrice += item.realPrice;\n    shopNames.push(item.shopName);\n  });\n\n  trade.shopName = shopNames.join(',');\n  trade.tradeNo = payNo;\n  // alert(JSON.stringify(trade));\n  weixinPay(window.openId, trade).then(res => {\n    // alert(JSON.stringify(res));\n    $.Loading.hide();\n    showSuccessTip('支付成功！', 3000);\n    paySuccess(tid).then(success, success);\n  }, e => {\n    // alert('error----' + JSON.stringify(e));\n    $.Loading.hide();\n    window.location.href = '/trade/list?status=2';\n  });\n\n  function success(res) {\n    if (trades.length === 1) {\n      window.location.href = `/trade/detail?tradeId=${trades[0].id}`;\n    } else {\n      window.location.href = '/trade/list?status=3';\n    }\n  }\n}\n\nclass Billing {\n  constructor() {\n    this.commitParams;\n    this.popup;\n    this.bills = globalData.bills;\n    this.postFlag = globalData.postFlag;\n    this.value = globalData.value;\n    this.combineId = globalData.combineId;\n    this.init();\n  }\n\n  init() {\n    if (this.postFlag === 1) {\n      this.addressId = null;\n      this.getAddList();\n    }\n    this.renderBills();\n\n    this.initEvent();\n\n    console.log(this.bills);\n  }\n  /**\n   * 获取买家的地址列表\n   */\n  getAddList() {\n    getAddressList().then((res) => {\n      this.addList = res.list;\n    });\n  }\n  /**\n   * 渲染订单\n   */\n  renderBills() {\n    var tpl = template.compile(tplBills)({\n      bills: this.bills\n    });\n    $('#billList').html(tpl);\n  }\n\n  initEvent() {\n    $(document).on('click', '.js-show-add', () => {\n      this.showAddList();\n    }).on('click', '.js-choose-add', (e) => {\n      this.chooseAdd($(e.currentTarget));\n    }).on('click', '.js-back', () => {\n      this.popup.cancel();\n    }).on('click', '.js-show-collect', (e) => {\n      this.showCollect($(e.currentTarget));\n    }).on('click', '.js-choose-collect', (e) => {\n      this.chooseCollect($(e.currentTarget));\n    }).on('click', '.js-select-date', e => {\n      this.showSelectColDate($(e.currentTarget));\n    }).on('click', '.js-commit:not(\".disabled\")', (e) => {\n      this.commit($(e.currentTarget));\n    }).on('change', '.js-invoice', (e) => {\n      this.toggleShowInvoiceOption($(e.currentTarget));\n    }).on('change', '.js-invoice-type', (e) => {\n      this.chooseInvoiceType($(e.currentTarget));\n    });\n  }\n\n  chooseInvoiceType($checkbox) {\n    console.log($checkbox.prop('checked'));\n    return false;\n  }\n  /**\n   * 展示发票信息表单\n   * @param  {Object} $checkbox checkbox对象\n   */\n  toggleShowInvoiceOption($checkbox) {\n    var $bill = $checkbox.parents('.js-bill');\n    // var billIndex = +$bill.data('index');\n    var $invoiceOption = $bill.find('.js-invoice-option');\n    if ($checkbox.prop('checked')) {\n      $invoiceOption.removeClass('z-hidden')\n    } else {\n      $invoiceOption.addClass('z-hidden')\n    }\n    // this.bills[billIndex].isInvoice = $checkbox.prop('checked') ? 1 : 0;\n  }\n  /**\n   * 提交订单\n   * @param  {Object} $btn 按钮\n   */\n  commit($btn) {\n    if (!this.validateForm()) {\n      return;\n    }\n    $btn.addClass('disabled');\n    this.getCommitParams();\n\n    $.Loading.show();\n    commitTrade(JSON.stringify(this.commitParams), this.value, this.combineId).then((res) => {\n      const data = res.data;\n\n      // alert(JSON.stringify(res));\n      payForTrade(data.payNo ? data.trades : data, data.payNo);\n    }, err => {\n      $btn.removeClass('disabled');\n      $.Loading.hide();\n      alert(JSON.stringify(err));\n    });\n  }\n  /**\n   * 获取将要提交的订单信息\n   */\n  getCommitParams() {\n    this.commitParams = this.bills.map((bill, index) => {\n      var $bill = $(`.js-bill[data-index=\"${index}\"]`);\n      var result = {};\n      if (!this.value) {\n        result.cartIdList = bill.listCartDto.map((cart) => {\n          return cart.id\n        });\n      }\n      result.enterpriseId = bill.enterpriseId;\n      // 地址\n      result.addressId = bill.distributionMode === 2 ? bill.addressId : this.addressId;\n      // 发票内容\n      result.isInvoice = $bill.find('.js-invoice').prop('checked') ? 1 : 0;\n      if (result.isInvoice === 1) {\n        result.invoiceType = $bill.find('.js-invoice-type:checked').val();\n        result.invoiceName = $bill.find('.js-invoice-name').val();\n      }\n      // 自提内容\n      if (bill.distributionMode === 2) {\n        result.buyerName = $bill.find('.js-collect-name').val();\n        result.buyerPhone = $bill.find('.js-collect-mobile').val();\n        result.collectTime = $bill.find('input[name=\"collectTime\"]').val();\n      }\n      result.buyerRemarks = $bill.find('textarea[name=\"buyerRemarks\"]').val();\n      return result;\n    });\n  }\n  /**\n   * 校验表单\n   * @return {Boolean} 是否通过验证\n   */\n  validateForm() {\n    if (this.postFlag === 1 && !this.addressId) {\n      Message.show({\n        content: '请选择快递收货地址'\n      });\n      return false;\n    }\n\n    return this.validateInvoice() && this.validateCollect();\n  }\n  /**\n   * 校验发票信息\n   * @return {Boolean} 是否通过验证\n   */\n  validateInvoice() {\n    var canSubmit = true;\n    var $bills = $('.js-bill');\n\n    for (let i = 0, len = $bills.length; i < len; i++) {\n      var $bill = $($bills[i]);\n      if (!$bill.find('.js-invoice').prop('checked')) {\n        continue;\n      } else if (!$bill.find('.js-invoice-name').val()) {\n        canSubmit = false;\n        Message.show({\n          content: '请输入发票抬头'\n        });\n        break;\n      }\n    }\n    return canSubmit;\n  }\n  /**\n   * 校验自提信息\n   * @return {Boolean} 是否通过验证\n   */\n  validateCollect() {\n    var canSubmit = true;\n    var regMobile = /^1[3578][0-9]{9}$/;\n    for (let i = 0, len = this.bills.length; i < len; i++) {\n      var bill = this.bills[i];\n      var $bill = $(`.js-bill[data-index=\"${i}\"]`);\n      if (bill.distributionMode === 1) {\n        continue;\n      }\n      if (bill.distributionMode === 2 && !bill.addressId) {\n        canSubmit = false;\n        Message.show({\n          content: '请选择自提地址'\n        });\n        break;\n      }\n      if (!$.trim($bill.find('.js-collect-name').val())) {\n        canSubmit = false;\n        Message.show({\n          content: '请输入自提人姓名'\n        });\n        break;\n      }\n      if (!regMobile.test($bill.find('.js-collect-mobile').val())) {\n        canSubmit = false;\n        Message.show({\n          content: '请输入正确的自提人手机'\n        });\n        break;\n      }\n    }\n    return canSubmit;\n  }\n  /**\n   * 选择自提地址\n   * @param  {Object} $add 被选的自提地址DOM\n   */\n  chooseCollect($add) {\n    var add;\n    var id = +$add.data('id');\n    var billIndex = +$add.data('bill');\n    this.bills[billIndex].collectPlaces.forEach((item) => {\n      if (item.id === id) {\n        add = item;\n      }\n    });\n    this.renderCollectAdd(add, billIndex);\n    this.popup.confirm();\n    this.bills[billIndex].addressId = id;\n    this.changeCollectPrice(billIndex, add);\n\n    const $date = $('.js-select-date[data-index=\"' + billIndex + '\"]');\n    const colStartDate = new Date(add.collectStartTime);\n    const $dateIpt = $date.find('input');\n    const dateStr = $.Datepicker.date2str($.Datepicker.parseDate(colStartDate));\n\n    $dateIpt.data('min', add.collectStartTime);\n    $dateIpt.data('max', add.collectEndTime);\n    $dateIpt.val(dateStr);\n    $date.find('span').text(`提货日期：${dateStr}`);\n    $date.removeClass('z-hidden');\n    this.showSelectColDate($date, add.collectStartTime, add.collectEndTime);\n  }\n\n  showSelectColDate($date, collectStartTime, collectEndTime) {\n    const $input = $date.find('input');\n    const val = $input.val();\n\n    if(!collectStartTime) {\n      collectStartTime = $input.data('min');\n      collectEndTime = $input.data('max');\n    }\n    const colStartDate = new Date(collectStartTime);\n    const colEndDate = new Date(collectEndTime);\n\n    $.Datepicker({\n      date: new Date(val.replace(/-/g, '/')),\n      minDate: colStartDate,\n      maxDate: colEndDate,\n      confirm: (dateStr) => {\n        $input.val(dateStr);\n        $date.find('span').text(`提货日期：${dateStr}`);\n      }\n    });\n  }\n\n  /**\n   * 更新自提订单的价格\n   * @param  {Number} index 订单索引\n   * @param  {Object} add   地址对象\n   */\n  changeCollectPrice(index, add) {\n    var $bill = $(`.js-bill[data-index=\"${index}\"]`);\n    var $billPrice = $bill.find('.js-bill-price');\n    var newPrice = +$billPrice.html() + add.fee;\n    $billPrice.html(newPrice);\n    $bill.find('.js-price-info').html(`（自提费￥${add.fee}）`);\n    this.changeTotalPrice();\n  }\n  /**\n   * 更新总价\n   */\n  changeTotalPrice() {\n    var total = 0;\n    $('.js-bill-price').each((index, price) => {\n      total += +$(price).html();\n    });\n    $('.js-total').html(total);\n  }\n  /**\n   * 渲染选中的自提地址\n   * @param  {Object} add       地址对象\n   * @param  {Number} billIndex 订单索引\n   */\n  renderCollectAdd(add, billIndex) {\n    var tpl = template.compile(tplAddDetail)({\n      add: add,\n      type: 2\n    });\n    $(`.js-bill[data-index=\"${billIndex}\"]`)\n      .find('.js-show-collect')\n      .html(tpl);\n  }\n  /**\n   * 展示自提地址列表\n   * @param  {Object} $btn 按钮对象\n   */\n  showCollect($btn) {\n    var index = +$btn.data('index');\n    if (!this.popup) {\n      this.popup = new Popup().render();\n    }\n    this.popup.renderContent(template.compile(tplAddList)({\n      addList: this.bills[index].collectPlaces,\n      type: 2,\n      billIndex: index\n    })).show();\n  }\n  /**\n   * 选择地址\n   * @param  {Object} $add 被选中的地址对象\n   */\n  chooseAdd($add) {\n    var id = +$add.data('id');\n    var add;\n    if (id === this.addressId) {\n      this.popup.cancel();\n      return;\n    }\n    this.addList.forEach((item) => {\n      if (item.id === id) {\n        add = item;\n      }\n    });\n    this.renderAdd(add);\n    this.popup.confirm();\n    this.addressId = id\n    this.changeExpressPrice();\n  }\n  /**\n   * 更新快递订单的价格\n   */\n  changeExpressPrice() {\n    var fn;\n    if (!this.value) {\n      var ids = [];\n      this.bills.forEach((bill) => {\n        if (bill.distributionMode === 1) {\n          ids = ids.concat(bill.listCartDto.map((cart) => {\n            return cart.id;\n          }));\n        }\n      });\n      asynExpress(ids.join(','), this.addressId).then((res) => {\n        this.renderExpressPrice(res);\n      });\n    } else {\n      asynCombineExpress(this.combineId, this.bills[0].enterpriseId, this.addressId).then((res) => {\n        this.renderExpressPrice(res);\n      });\n    }\n  }\n\n  renderExpressPrice(res) {\n    var newBills = res.data.cartDtos;\n      newBills.forEach((bill) => {\n        var $bill = $(`.js-bill[data-id=\"${bill.enterpriseId}\"]`);\n        var $billPrice = $bill.find('.js-bill-price');\n        var newPrice = +$billPrice.html() + bill.discountDto.expressPrice;\n        $billPrice.html(newPrice);\n        $bill.find('.js-price-info').html(`（快递费￥${bill.discountDto.expressPrice}）`);\n        this.changeTotalPrice();\n      });\n  }\n\n  /**\n   * 渲染被选中的快递地址\n   * @param  {Object} add 地址对象\n   */\n  renderAdd(add) {\n    var tpl = template.compile(tplAddDetail)({\n      add: add,\n      type: 1\n    });\n    $('.js-add-detail').html(tpl);\n  }\n  /**\n   * 展示快递地址列表\n   */\n  showAddList() {\n    if (!this.popup) {\n      this.popup = new Popup().render();\n    }\n    this.popup.renderContent(template.compile(tplAddList)({\n      addList: this.addList,\n      type: 1\n    })).show();\n\n  }\n}\n\nnew Billing();\n\n\n/** WEBPACK FOOTER **\n ** ./assets/pages/billing/index.js\n **/","module.exports = \"<div class=detail> {{if type === 1}} <div>收货人：{{add.buyerName}}</div> <div>电话：{{add.buyerPhone}}</div> <div>收货地址：{{add.province}}{{add.city}}{{add.region}}{{add.buyerAddress}}</div> {{else if type === 2}} <div>自提点：{{add.clpName}}</div> <div>自提点电话：{{add.clpTelephone}}</div> <div>自提点地址：{{add.clpAddress}}</div> <div>营业时间：{{add.startTime}}～{{add.endTime}}</div> {{/if}} </div>\";\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./assets/pages/billing/address-detail.tpl\n ** module id = 80\n ** module chunks = 1\n **/","module.exports = \"<div class=address-wrap id=main style=background-color:#f7f7f7> <div class=address-content> {{if type === 1}} {{each addList as add}} <div class=\\\"address js-choose-add\\\" data-id={{add.id}}> <a href=javascript:void(0); class=\\\"address-info choose\\\"> <div class=ad-info> <div>{{add.buyerName}}</div> <div>{{add.buyerPhone}}</div> </div> <div class=ad-detail>{{add.province}}{{add.city}}{{add.region}}{{add.buyerAddress}}</div> </a> </div> {{/each}} {{else if type === 2}} {{each addList as add}} <div class=\\\"address js-choose-collect\\\" data-id={{add.id}} data-bill={{billIndex}}> <a href=javascript:void(0); class=\\\"address-info choose\\\"> <div class=ad-info> <div>{{add.clpName}}</div> <div>{{add.clpTelephone}}</div> </div> <div class=ad-detail>{{add.clpAddress}}</div> </a> </div> {{/each}} {{/if}} </div> </div> <div class=buttons> {{if type === 1}} <a href=/buyAddress/list class=new-btn>添加新地址</a> {{/if}} <a href=javascript:void(0); class=\\\"back-btn js-back\\\">返回</a> </div>\";\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./assets/pages/billing/address-list.tpl\n ** module id = 81\n ** module chunks = 1\n **/","module.exports = \"{{each bills as bill index}} <div class=\\\"bill js-bill\\\" data-index={{index}} data-id={{bill.enterpriseId}}> <div class=\\\"shop-header bill-item\\\"> <img src={{bill.headPicUrl}} alt=\\\"\\\" class=shop-pic> <span>{{bill.enterpriseName}}</span> </div> <div class=items> {{each bill.listCartDto as item}} <div class=item> <a href=javascript:void(0);> <img src={{item.picPath}} alt=\\\"\\\" class=product> </a> <div class=pro-right> <div class=pro-name>{{item.productName}}</div> <div class=pro-sku>{{item.propertiesname}}</div> <div class=detail> <span class=price>￥ {{item.productRealPrice}}</span> <span class=num>X {{item.num}}</span> </div> </div> </div> {{/each}} </div> {{if bill.discountDto.discountDesc}} <div class=\\\"deliver bill-item\\\"> <span>优惠信息：</span> <span>{{bill.discountDto.discountDesc}}</span> </div> {{/if}} {{if bill.distributionMode === 2}} <div class=\\\"bill-item bill-link js-show-collect\\\" data-index={{index}}> <span>请选择自提地址</span> </div> <div class=\\\"bill-item bill-link z-hidden js-select-date\\\" data-index={{index}}> <input type=hidden name=collectTime> <span>请选择提货时间</span> </div> <div class=bill-item> 自提人姓名：<input type=text class=\\\"bill-input js-collect-name\\\" placeholder=自提人姓名> </div> <div class=bill-item> 自提人手机：<input type=number class=\\\"bill-input js-collect-mobile\\\" placeholder=自提人手机> </div> {{/if}} <div class=bill-item> <label class=radios_box> <input type=checkbox class=\\\"input_redu js-invoice\\\"> </label> <span>是否需要发票</span> </div> <div class=\\\"bill-item js-invoice-option z-hidden\\\"> <label class=\\\"radios_box checked\\\"> <input type=radio name=invoiceType class=\\\"input_redu js-invoice-type\\\" checked=checked value=1> </label> <span>电子发票</span> <label class=radios_box> <input type=radio name=invoiceType class=\\\"input_redu js-invoice-type\\\" value=2> </label> <span>纸质发票</span> </div> <div class=\\\"bill-item js-invoice-option z-hidden\\\"> <input type=text class=\\\"bill-input bill-input-invoice js-invoice-name\\\" placeholder=发票抬头> </div> <div class=\\\"memo bill-item\\\"> <textarea class=bill-input name=buyerRemarks placeholder=给卖家留言></textarea> </div> <div class=\\\"total bill-item\\\"> <span>共 <strong>{{bill.num}}</strong> 件商品</span> <span>合计：<strong>￥ <span class=js-bill-price>{{bill.discountDto.realPrice}}</span><span class=js-price-info></span></strong></span> </div> </div> {{/each}}\";\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./assets/pages/billing/bill.tpl\n ** module id = 82\n ** module chunks = 1\n **/"],"sourceRoot":""}